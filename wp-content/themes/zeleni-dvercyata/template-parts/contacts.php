<?php
/**
 * Шаблонная часть для отображения контактов
 *
 * @param array $args {
 * @type bool $show_icon Показывать ли иконки телефона. По умолчанию false.
 * }
 */

 // 1. Устанавливаем значения по умолчанию для наших аргументов.
$defaults = [
    'show_icons' => false, // По умолчанию иконки не показываем
];

// 2. Объединяем значения по умолчанию с реально переданными аргументами.
// Если 'show_icon' не был передан, он примет значение из $defaults.
$args = wp_parse_args($args ?? [], $defaults);

// 3. Получаем нужные данные из глобальной переменной $options
$options = get_theme_options();

// 4. Для удобства извлечем все нужные нам данные в переменные.
$contact_phone   = $options['contact_phone'] ?? '';
$phone_href      = $options['phone_href'] ?? '';
$working_hours_structured = $options['working_hours_structured'];

$contact_info    = $options['contact_info'] ?? [];
$city            = $contact_info['contact_city'] ?? '';
$street          = $contact_info['contact_street'] ?? '';
$google_map_link = $contact_info['contact_google_maps'] ?? '';

?>
    <address class="contacts-address">
        <!-- Контакты -->
        <?php if ($city && $street && $google_map_link): ?>
            <p class="contacts-address__item">
                <?php if ($args['show_icons']): ?>
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16" fill="none">
                        <path d="M0.957501 9.25473L0.987501 9.2981C1.02417 9.35314 1.0625 9.4065 1.10083 9.46488L5.44417 15.7091C5.50665 15.7989 5.58991 15.8722 5.68683 15.9229C5.78376 15.9735 5.89149 16 6.00083 16C6.11018 16 6.21791 15.9735 6.31483 15.9229C6.41176 15.8722 6.49501 15.7989 6.5575 15.7091L10.8908 9.46988C10.9325 9.41151 10.9725 9.3548 11.0125 9.3031L11.0392 9.26307C11.6247 8.35646 11.9552 7.30864 11.9958 6.22993C12.0363 5.15121 11.7855 4.0815 11.2698 3.1334C10.754 2.18529 9.99232 1.39388 9.06493 0.842453C8.13755 0.29103 7.07875 0 6 0C4.92125 0 3.86245 0.29103 2.93506 0.842453C2.00768 1.39388 1.24601 2.18529 0.730236 3.1334C0.214463 4.0815 -0.0363334 5.15121 0.0042479 6.22993C0.0448292 7.30864 0.375287 8.35646 0.960834 9.26307L0.957501 9.25473ZM6.00083 3.50585C6.49529 3.50585 6.97864 3.65257 7.38976 3.92746C7.80088 4.20235 8.12131 4.59306 8.31053 5.05018C8.49975 5.50731 8.54926 6.01031 8.4528 6.49559C8.35633 6.98088 8.11823 7.42663 7.7686 7.7765C7.41897 8.12637 6.97351 8.36463 6.48856 8.46116C6.00361 8.55769 5.50094 8.50815 5.04412 8.3188C4.58731 8.12945 4.19686 7.80881 3.92216 7.3974C3.64746 6.986 3.50083 6.50233 3.50083 6.00754C3.50083 5.34405 3.76423 4.70773 4.23307 4.23857C4.70191 3.76942 5.33779 3.50585 6.00083 3.50585Z" fill="#309B19"/>
                    </svg>
                <?php endif; ?>
                <a href="<?php echo esc_url($google_map_link); ?>" target="_blank">
                    <?php echo 'м. ' . esc_html($city) . ',<br> ' . esc_html($street) ?>
                </a>
            </p>
        <?php endif; ?>

        <!-- Время работы -->
        <?php if ($working_hours_structured): ?>
            <p class="contacts-address__item">
                <?php if ($args['show_icons']): ?>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" role="presentation">
                        <path d="M8.00002 3.42871C7.09588 3.42871 6.21204 3.69682 5.46027 4.19914C4.7085 4.70145 4.12257 5.41541 3.77657 6.25073C3.43057 7.08605 3.34004 8.00521 3.51643 8.89198C3.69282 9.77875 4.12821 10.5933 4.76753 11.2326C5.40686 11.872 6.22141 12.3073 7.10818 12.4837C7.99495 12.6601 8.91411 12.5696 9.74943 12.2236C10.5847 11.8776 11.2987 11.2917 11.801 10.5399C12.3033 9.78812 12.5714 8.90428 12.5714 8.00014C12.5698 6.78821 12.0877 5.62638 11.2307 4.76942C10.3738 3.91246 9.21195 3.43031 8.00002 3.42871ZM8.57145 8.00014C8.57034 8.15163 8.511 8.2969 8.40573 8.40585L7.26288 9.54871C7.15455 9.65493 7.00888 9.71443 6.85716 9.71443C6.70544 9.71443 6.55978 9.65493 6.45145 9.54871C6.34439 9.44082 6.28431 9.29499 6.28431 9.143C6.28431 8.991 6.34439 8.84517 6.45145 8.73728L7.42859 7.76585V5.143C7.42859 4.99144 7.48879 4.8461 7.59596 4.73894C7.70312 4.63177 7.84847 4.57157 8.00002 4.57157C8.15157 4.57157 8.29692 4.63177 8.40408 4.73894C8.51124 4.8461 8.57145 4.99144 8.57145 5.143V8.00014Z" fill="#309B19"/>
                        <path d="M8 0C6.41775 0 4.87103 0.469192 3.55544 1.34824C2.23985 2.22729 1.21447 3.47672 0.608967 4.93853C0.00346627 6.40034 -0.15496 8.00887 0.153721 9.56072C0.462403 11.1126 1.22433 12.538 2.34315 13.6569C3.46197 14.7757 4.88743 15.5376 6.43928 15.8463C7.99113 16.155 9.59966 15.9965 11.0615 15.391C12.5233 14.7855 13.7727 13.7602 14.6518 12.4446C15.5308 11.129 16 9.58225 16 8C15.9977 5.87898 15.1541 3.8455 13.6543 2.34572C12.1545 0.845932 10.121 0.00232928 8 0ZM8 13.7143C6.86982 13.7143 5.76503 13.3791 4.82532 12.7513C3.88561 12.1234 3.15319 11.2309 2.72069 10.1868C2.28819 9.14261 2.17503 7.99366 2.39552 6.8852C2.616 5.77673 3.16024 4.75855 3.95939 3.95939C4.75855 3.16023 5.77674 2.616 6.8852 2.39551C7.99366 2.17503 9.14261 2.28819 10.1868 2.72069C11.2309 3.15319 12.1234 3.8856 12.7513 4.82531C13.3791 5.76502 13.7143 6.86982 13.7143 8C13.7118 9.51476 13.109 10.9668 12.0379 12.0379C10.9668 13.109 9.51476 13.7118 8 13.7143Z" fill="#309B19"/>
                    </svg>
                <?php endif; ?>
                <span>
                    <?php
                    // Выводим все строки расписания из поля Repeater
                    foreach ($working_hours_structured as $i => $row) {
                        echo esc_html($row['working_days']) . ' ' . esc_html($row['working_time']);

                        // Добавляем <br>, если это не последняя строка
                        if ($i < count($working_hours_structured) - 1) {
                            echo '<br>';
                        }
                    }
                    ?>
                </span>
            </з>
        <?php endif; ?>
        <!-- Телефон -->
        <?php if ($contact_phone && $phone_href): ?>
            <p class="contacts-address__item">
                <?php if ($args['show_icons']): ?>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" role="presentation">
                        <path d="M3.93926 12.0366C6.59806 14.6898 8.91692 16.0002 11.0233 16C12.2324 15.9998 13.3718 15.5678 14.4644 14.7099C14.6055 14.5988 14.7399 14.4796 14.867 14.3529C15.1033 14.117 15.313 13.8559 15.4924 13.5742C15.6732 13.288 15.8233 12.9836 15.9404 12.666C16.0139 12.4648 16.0196 12.245 15.9565 12.0403C15.8933 11.8356 15.7648 11.6572 15.5907 11.5323L12.794 9.52852C12.5896 9.38319 12.3374 9.32134 12.0888 9.35559C11.8403 9.38985 11.6143 9.51762 11.4568 9.71282L10.2123 11.2963C10.1802 11.3386 10.1337 11.3678 10.0816 11.3782C10.0295 11.3887 9.9754 11.3797 9.92947 11.353C8.85396 10.6908 7.86101 9.90323 6.97152 9.00677C6.07385 8.12009 5.28462 7.13008 4.62036 6.0575C4.59386 6.01199 4.585 5.95835 4.59546 5.90674C4.60593 5.85513 4.63499 5.80917 4.67714 5.77758L6.27357 4.52928C6.46678 4.37155 6.5926 4.14616 6.62544 3.89898C6.65827 3.6518 6.59565 3.4014 6.45031 3.19873L4.44188 0.408433C4.31671 0.234636 4.13816 0.106483 3.9334 0.0434818C3.72864 -0.0195192 3.5089 -0.0139161 3.30762 0.0594379C2.67253 0.289168 2.09525 0.654646 1.61604 1.13037C0.543602 2.20026 0 3.44959 0 4.84366C0 7.00843 1.32524 9.42856 3.93926 12.0366Z" fill="#309B19"/>
                    </svg>
                <?php endif; ?>
                <a href="<?php echo esc_attr($phone_href); ?>" class="contacts-address__phone"><?php echo esc_html($contact_phone); ?></a>
            </p>
        <?php endif; ?>
    </address>
